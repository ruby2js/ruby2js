<!DOCTYPE html>
<html>
<head>
  <title>Rails-in-JS Blog</title>
  <link rel="stylesheet" href="./public/styles.css">
</head>
<body>
  <div id="loading">Loading Rails-in-JS...<br><small>Powered by transpiled Ruby code</small></div>
  <div id="app">
    <nav>
      <a onclick="navigate('/')">Home</a>
      <a onclick="navigate('/articles')">Articles</a>
      <a onclick="navigate('/articles/new')">New Article</a>
      <span class="transpiled-badge">Transpiled Ruby &rarr; JS</span>
    </nav>
    <main id="content"></main>
  </div>

  <script src="./node_modules/sql.js/dist/sql-wasm.js"></script>
  <script type="module">
    import { Application } from './dist/config/routes.js';
    Application.start();
  </script>

  <!-- Hot reload client (connects to dev server WebSocket) -->
  <script>
    (function() {
      // Only connect if running on localhost (dev server)
      if (location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') return;

      const ws = new WebSocket(`ws://${location.host}`);

      ws.onmessage = function(event) {
        const data = JSON.parse(event.data);
        if (data.type === 'reload') {
          console.log('[dev] Reloading...');
          location.reload();
        }
      };

      ws.onopen = function() {
        console.log('[dev] Hot reload connected');
      };

      ws.onclose = function() {
        console.log('[dev] Hot reload disconnected, retrying in 2s...');
        setTimeout(function() { location.reload(); }, 2000);
      };
    })();
  </script>
</body>
</html>
