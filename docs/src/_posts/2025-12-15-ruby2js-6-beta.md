---
layout: post
title: "Ruby2JS 6.0 Beta: Self-Hosted, Expanded, and Ready for Ruby 4.0"
subtitle: A major release that takes the project in an unexpected direction—expanding rather than contracting.
categories: updates
author: rubys
published: false
---

Nearly three years ago, this blog announced that Ruby2JS would [narrow its focus](/updates/future-of-ruby2js)—deprecating filters, reducing scope, and potentially becoming obsolete as Ruby WASM matured. Today's announcement goes in the opposite direction.

**Ruby2JS 6.0 beta is available now**, with:

- A self-hosted JavaScript implementation (no Ruby required)
- Expanded framework support (Turbo, Alpine.js, ActionCable, and more)
- A comprehensive User's Guide for dual-target development
- Modern ECMAScript support (ES2023, ES2024, ES2025)
- Full compatibility with Ruby 4.0 and the Prism parser

## Try It Now

**CLI** — Four commands get you a working converter (no Ruby required):

```bash
wget https://www.ruby2js.com/demo/selfhost/ruby2js.mjs
chmod +x ruby2js.mjs
npm install @ruby/prism
./ruby2js.mjs -e 'puts "hello"'
```

**Browser** — Import directly:

```html
<script type="module">
  import { convert } from 'https://www.ruby2js.com/demo/selfhost/ruby2js.mjs';
  console.log(convert('puts "hello"'));
</script>
```

Or visit the [self-hosted demo](https://www.ruby2js.com/demo/selfhost/) to try it interactively.

**Ruby gem**:

```bash
gem install ruby2js --pre
```

## The Self-Hosting Breakthrough

The 2023 post mentioned being "locked into an old version of Opal" for the JavaScript build. We've since upgraded to the latest Opal, and we've also built something new: Ruby2JS transpiling **itself** to JavaScript.

The unified `ruby2js.mjs` bundle is about **200KB** (excluding Prism WASM). It includes:

- All 60+ converter handlers
- The PrismWalker (Prism AST → Parser-compatible format)
- The Serializer (output formatting)
- 245 tests passing

This isn't just a technical achievement. It proves that Ruby2JS handles substantial, real-world Ruby code—its own implementation. And it enables **dual-target development**: the same Ruby source running on the server and in the browser. The [showcase](https://github.com/rubys/showcase) dance competition app demonstrates this—sharing validation and business logic between Rails and the browser for offline-first functionality.

The plan is to offer three side-by-side demos comparing self-hosted, Opal, and Ruby WASM approaches—so you can evaluate the tradeoffs yourself.

## New User's Guide

The [User's Guide](/docs/users-guide/introduction) is entirely new, with live demos throughout:

- **[Dual-Target Development](/docs/users-guide/introduction)** — Write Ruby that runs natively AND transpiles to JavaScript
- **[Patterns](/docs/users-guide/patterns)** — Classes, methods, blocks, arrays, hashes that translate cleanly
- **[Pragmas](/docs/users-guide/pragmas)** — Line-level control via comments (`# Pragma: skip`, `# Pragma: ??`)
- **[Anti-Patterns](/docs/users-guide/anti-patterns)** — What to avoid (metaprogramming, eval)
- **[JavaScript-Only](/docs/users-guide/javascript-only)** — Using Ruby syntax for browser/Node.js code

## Enhanced Ruby Pattern Support

The functions filter now handles more Ruby patterns correctly:

**Type introspection:**
```ruby
obj.is_a?(Array)      # → Array.isArray(obj)
obj.is_a?(String)     # → typeof obj === "string"
obj.is_a?(Integer)    # → typeof obj === "number" && Number.isInteger(obj)
obj.is_a?(MyClass)    # → obj instanceof MyClass
obj.instance_of?(Foo) # → obj.constructor === Foo
obj.respond_to?(:x)   # → "x" in obj
```

**Class introspection:**
```ruby
obj.class             # → obj.constructor
obj.class.name        # → obj.constructor.name
Foo.superclass        # → Object.getPrototypeOf(Foo.prototype).constructor
```

**Module mixins:**
```ruby
class MyClass
  include Loggable    # → Object.defineProperties(MyClass.prototype, ...)
  extend Configurable # → Object.defineProperties(MyClass, ...)
end
```

These additions were driven by self-hosting requirements—Ruby2JS's own code uses these patterns extensively.

## Expanded Framework Support

Instead of deprecating framework filters, we've added new ones:

| Filter | Purpose |
|--------|---------|
| **[ERB](/docs/filters/erb)** | ERB template → render function |
| **[Turbo](/docs/filters/turbo)** | Custom Turbo Stream actions |
| **[Alpine.js](/docs/filters/alpine)** | Alpine.data component registration |
| **[ActionCable](/docs/filters/action_cable)** | WebSocket subscription DSL |
| **[HAML](/docs/filters/haml)** | HAML template → render function |
| **[Jest](/docs/filters/jest)** | RSpec-style testing syntax |
| **[Stimulus](/docs/filters/stimulus)** | Now with outlets support (3.x) |

The React filter has been modernized for hooks (removing legacy `createClass` patterns), and the JSX filter remains supported.

### New General-Purpose Filters

Two filters extracted from the self-hosting work:

**[Polyfill](/docs/filters/polyfill)** — Adds JavaScript prototype polyfills for Ruby methods. Instead of transforming `.first` to `[0]`, it preserves the method name:

```javascript
Object.defineProperty(Array.prototype, "first", {
  get() { return this[0] },
  configurable: true
});
```

**[Pragma](/docs/filters/pragma)** — Fine-grained control over individual lines:

```ruby
x ||= default           # May become ??= or ||= depending on context
y ||= default # Pragma: ??      # Force nullish coalescing
z ||= default # Pragma: logical # Force logical OR
```

## Modern ECMAScript

Ruby2JS 6.0 supports ES2023, ES2024, and ES2025 features. We're also **dropping support for ES levels below 2020**—nullish coalescing (`??`) and optional chaining (`?.`) are now baseline assumptions.

The `or` operator now defaults to nullish coalescing:

```ruby
x ||= default  # → x ??= default
```

Use `# Pragma: logical` when you need the old `||` behavior.

## What's Next

The beta focuses on core functionality. Before the final release:

- Self-hosted `functions` and `esm` filters
- Additional documentation polish

Longer term, we're exploring [SFC integration](/plans/SFC_FRAMEWORK_INTEGRATION.md) for Vue, Svelte, and Astro—using native framework compilers to parse single-file components, with Ruby2JS converting just the script sections.

## Breaking Changes

- **Minimum ES level is now ES2020** — Older levels are no longer supported
- **Nullish coalescing is default** — `||=` becomes `??=` by default
- **`.class` now converts by default** — `obj.class` becomes `obj.constructor` when using the functions filter (previously required explicit `include: [:class]`)
- **Retired filters**: matchAll, underscore, vue, jquery (as announced in 2023)

## Get Involved

Ruby2JS is open source: [github.com/ruby2js/ruby2js](https://github.com/ruby2js/ruby2js)

- **[Issues](https://github.com/ruby2js/ruby2js/issues)** and **[Pull Requests](https://github.com/ruby2js/ruby2js/pulls)** welcome
- **[Discussions](https://github.com/ruby2js/ruby2js/discussions)** for questions and ideas
- **Documentation contributions** especially appreciated

---

*For the technical deep-dive on self-hosting, see [Ruby2JS Self-Hosting Update](http://intertwingly.net/blog/2025/12/12/Ruby2JS-Selfhost-Update.html).*
